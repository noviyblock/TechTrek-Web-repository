# Эндпоинты аутентификации

## Регистрация
Метод: POST /api/auth/register

### Описание
Регистрирует нового пользователя в системе.

### Тело запроса
````json
{
"username": "string",
"password": "string",
"email": "string"
}
````
### Тело ответа

````json
{
"accessToken": "token",
"refreshToken": "token"
}
````
Код успешного ответа

    200 OK — Успешная регистрация, возвращается объект аутентификации.


### Возможные ошибки

- 409 Conflict — Если пользователь с таким username или email уже существует в системе.
- 400 Bad Request — Если тело запроса некорректное (например, отсутствует обязательное поле или оно не соответствует требованиям).
- 500 Internal Server Error — Внутренняя ошибка сервера при обработке запроса.

Эндпоинт генерирует два JWT токена, refresh с временем жизни 7 дней и access с временем жизни 15 минут.

[Подробнее см. раздел «JWT: Внутренняя реализация»](auth-logic.md)

## Логин

Метод: POST /api/auth/login

### Тело запроса

````json
{
  "email": "user@example.com",
  "password": "userpassword"
}
````

### Тело ответа

````json
{
  "accessToken": "<jwt-access-token>",
  "refreshToken": "<jwt-refresh-token>"
}
````

### Код успешного ответа

- 200 OK Аутентификация успешна, возвращены JWT токены

### Возможные ошибки

- 401 Unauthorized Неверные учетные данные

- 500 Internal Server Error Внутренняя ошибка сервера

> В случае ошибки 500 без дополнительной информации в ответе - можно посмотреть лог ошибки в Kibana.

## Обновление аксес токена

Метод: POST /api/auth/refresh

### Описание
Позволяет получить новый access токен на основе действующего refresh токена. Используется, когда срок действия текущего access токена истёк.

### Тело запроса

````json
{
  "refreshToken": "<jwt-refresh-token>"
}
````

### Тело ответа
````json
{
  "accessToken": "<new-jwt-access-token>"
}
````

### Код успешного ответа

- 200 OK Access токен успешно обновлён

### Ошибки
- 401 Unauthorized в случае недействительного или истекшего токена

- ExpiredJwtException — refresh токен истёк.

- Общий Exception — refresh токен некорректен или отсутствует в БД.

> В случае ошибки 500 без дополнительной информации в ответе - можно посмотреть лог ошибки в Kibana.

## Проверка авторизации

Метод: GET /api/auth/status

### Описание

Позволяет проверить, авторизован ли текущий пользователь. Используется, как правило, на клиенте для верификации состояния сессии.

### Заголовки запроса

Authorization: Bearer <access-token

### Ответы

- Успешный ответ - User is authorized

- 401 Unauthorized Пользователь неавторизован или токен недействителен

## Выход из системы

### Описание
Удаляет переданный refresh токен из базы данных, тем самым делая невозможным дальнейшее получение новых access токенов. Используется для реализации механизма выхода пользователя из системы.

### Тело запроса
````json
{
  "refreshToken": "<jwt-refresh-token>"
}
````

### Ответ

- 204 No Content Выход выполнен, токен удалён